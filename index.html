<!DOCTYPE html>
<html lang="en">
<head>
  <base href="/WorkProof/">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="WorkProof" />
  <meta name="description" content="Track your work hours with timecard proof for your resume" />
  <meta name="theme-color" content="#2563eb" />

  <title>WorkProof - Professional Hours Tracker</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <link rel="icon" href="icon-512.png" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    svg { stroke: currentColor; }
    img.responsive { max-width:100%; height:auto; display:block; }
  </style>
</head>
<body class="bg-slate-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { createClient } = window.supabase;

    // Initialize Supabase
    const SUPABASE_URL = "https://lypnzomzrppvzqiobkcp.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5cG56b216cnBwdnpxaW9ia2NwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NzUxMzAsImV4cCI6MjA3ODU1MTEzMH0.URm48DLZUzxWmAe8n_aHXFjdNZj-z4RWOTSf9G5bnlQ";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function WorkProofApp() {
      // Auth state
      const [authView, setAuthView] = useState('loading');
      const [currentUser, setCurrentUser] = useState(null);
      const [authForm, setAuthForm] = useState({
        email: '',
        password: '',
        confirmPassword: '',
        name: ''
      });
      const [authError, setAuthError] = useState('');
      const [authLoading, setAuthLoading] = useState(false);

      // App state
      const [mode, setMode] = useState('free');
      const [view, setView] = useState('dashboard');
      const [positions, setPositions] = useState([]);
      const [shifts, setShifts] = useState([]);
      const [newPosition, setNewPosition] = useState('');
      const [showInstallPrompt, setShowInstallPrompt] = useState(false);
      const [deferredPrompt, setDeferredPrompt] = useState(null);
      const [currentShift, setCurrentShift] = useState({
        date: new Date().toISOString().split('T')[0],
        startTime: '',
        endTime: '',
        positionId: '',
        timecardPhoto: null,
        photoPreview: null
      });

      // Check for existing session on mount
      useEffect(() => {
        checkSession();
      }, []);

      const checkSession = async () => {
        try {
          const { data: { session } } = await supabase.auth.getSession();
          if (session?.user) {
            console.log('Session found, user email:', session.user.email);
            setCurrentUser(session.user);
            setAuthView('app');
            await loadUserData(session.user.id);
          } else {
            setAuthView('login');
          }
        } catch (error) {
          console.error('Session check error:', error);
          setAuthView('login');
        }
      };

      const loadUserData = async (userId) => {
        try {
          console.log('Loading user data for:', userId);
          
          // Load positions
          const { data: posData, error: posError } = await supabase
            .from('positions')
            .select('*')
            .eq('user_id', userId);

          if (posError) console.error('Positions error:', posError);
          if (posData && posData.length > 0) {
            const normalized = posData.map(p => ({ id: p.id, name: p.name }));
            setPositions(normalized);
            console.log('Loaded positions:', normalized);
          } else {
            setPositions([]);
          }

          // Load shifts
          const { data: shiftData, error: shiftsError } = await supabase
            .from('shifts')
            .select('*')
            .eq('user_id', userId);

          if (shiftsError) console.error('Shifts error:', shiftsError);
          if (shiftData && shiftData.length > 0) {
            const normalized = shiftData.map(s => ({
              id: s.id,
              date: s.date,
              startTime: s.start_time,
              endTime: s.end_time,
              positionId: s.position_id,
              hours: Number(s.hours || 0),
              timecardPhoto: s.photo_url ? 'uploaded' : null,
              photoPreview: s.photo_url,
              created_at: s.created_at
            }));
            setShifts(normalized);
            console.log('Loaded shifts:', normalized);
          } else {
            setShifts([]);
          }

          // Load profile for mode - use maybeSingle() instead of single()
          const { data: profileData, error: profileError } = await supabase
            .from('profiles')
            .select('mode')
            .eq('id', userId)
            .maybeSingle();

          if (profileError) console.log('Profile error:', profileError);
          if (profileData?.mode) {
            setMode(profileData.mode);
            console.log('Loaded mode:', profileData.mode);
          } else {
            setMode('free');
            console.log('No profile found, using default mode: free');
          }
        } catch (error) {
          console.error('Error loading user data:', error);
        }
      };

      const handleSignup = async (e) => {
        e.preventDefault();
        setAuthError('');
        setAuthLoading(true);

        try {
          if (!authForm.email || !authForm.password || !authForm.name) {
            throw new Error('All fields are required');
          }

          if (authForm.password !== authForm.confirmPassword) {
            throw new Error('Passwords do not match');
          }

          if (authForm.password.length < 6) {
            throw new Error('Password must be at least 6 characters');
          }

          const { data, error } = await supabase.auth.signUp({
            email: authForm.email,
            password: authForm.password,
            options: {
              data: { full_name: authForm.name }
            }
          });

          if (error) throw error;

          const user = data.user;
          if (!user) {
            throw new Error('Sign-up started. Please confirm your email before continuing.');
          }

          console.log('User created:', user.id);

          // Create profile - use INSERT instead of UPSERT to trigger auth hook
          const { error: profileError } = await supabase.from('profiles').insert({
            id: user.id,
            full_name: authForm.name,
            mode: 'free'
          });

          if (profileError) {
            console.error('Profile creation error:', profileError);
            // Don't throw - continue anyway, profile will be created by auth trigger
          } else {
            console.log('Profile created successfully');
          }

          setCurrentUser(user);
          setAuthView('app');
          setAuthForm({ email: '', password: '', confirmPassword: '', name: '' });
          await loadUserData(user.id);
        } catch (error) {
          console.error('Signup error:', error);
          setAuthError(error.message);
        } finally {
          setAuthLoading(false);
        }
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        setAuthError('');
        setAuthLoading(true);

        try {
          if (!authForm.email || !authForm.password) {
            throw new Error('Email and password are required');
          }

          const { data, error } = await supabase.auth.signInWithPassword({
            email: authForm.email,
            password: authForm.password
          });

          if (error) throw error;

          const user = data.user;
          console.log('Login successful, user:', user.email);
          setCurrentUser(user);
          setAuthView('app');
          await loadUserData(user.id);
          setAuthForm({ email: '', password: '', confirmPassword: '', name: '' });
        } catch (error) {
          console.error('Login error:', error);
          setAuthError(error.message);
        } finally {
          setAuthLoading(false);
        }
      };

      const handleLogout = async () => {
        try {
          await supabase.auth.signOut();
          setCurrentUser(null);
          setAuthView('login');
          setPositions([]);
          setShifts([]);
          setMode('free');
          setView('dashboard');
        } catch (error) {
          console.error('Logout error:', error);
        }
      };

      const savePositions = async (newPositions) => {
        if (!currentUser) return;
        setPositions(newPositions);

        try {
          const toUpsert = newPositions.map(p => ({
            id: p.id,
            user_id: currentUser.id,
            name: p.name,
            created_at: new Date().toISOString()
          }));

          console.log('Saving positions:', toUpsert);
          const { error } = await supabase.from('positions').upsert(toUpsert, { onConflict: 'id' });
          if (error) throw error;
          console.log('Positions saved successfully');
        } catch (error) {
          console.error('Error saving positions:', error);
        }
      };

      const saveShifts = async (newShifts) => {
        if (!currentUser) return;
        setShifts(newShifts);

        try {
          const toUpsert = newShifts.map(s => ({
            id: s.id,
            user_id: currentUser.id,
            position_id: s.positionId,
            date: s.date,
            start_time: s.startTime,
            end_time: s.endTime,
            hours: s.hours,
            photo_url: s.photoPreview || null,
            created_at: new Date().toISOString()
          }));

          console.log('Saving shifts:', toUpsert);
          const { error } = await supabase.from('shifts').upsert(toUpsert, { onConflict: 'id' });
          if (error) throw error;
          console.log('Shifts saved successfully');
        } catch (error) {
          console.error('Error saving shifts:', error);
        }
      };

      const saveMode = async (newMode) => {
        if (!currentUser) return;
        setMode(newMode);

        try {
          const { error } = await supabase.from('profiles').upsert({
            id: currentUser.id,
            mode: newMode
          });
          if (error) throw error;
        } catch (error) {
          console.error('Error saving mode:', error);
        }
      };

      // PWA Install Prompt
      useEffect(() => {
        const handler = (e) => {
          e.preventDefault();
          setDeferredPrompt(e);
          setShowInstallPrompt(true);
        };
        window.addEventListener('beforeinstallprompt', handler);
        return () => window.removeEventListener('beforeinstallprompt', handler);
      }, []);

      const handleInstall = async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        setDeferredPrompt(null);
        setShowInstallPrompt(false);
      };

      const isInstalled = window.matchMedia('(display-mode: standalone)').matches;

      const addPosition = () => {
        if (newPosition.trim()) {
          const position = { id: Date.now().toString(), name: newPosition.trim() };
          savePositions([...positions, position]);
          setNewPosition('');
        }
      };

      const deletePosition = (id) => {
        savePositions(positions.filter(p => p.id !== id));
      };

      const handlePhotoUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => {
            setCurrentShift({
              ...currentShift,
              timecardPhoto: file.name,
              photoPreview: reader.result
            });
          };
          reader.readAsDataURL(file);
        }
      };

      const calculateHours = (start, end) => {
        if (!start || !end) return 0;
        const [startHour, startMin] = start.split(':').map(Number);
        const [endHour, endMin] = end.split(':').map(Number);
        let startMinutes = startHour * 60 + startMin;
        let endMinutes = endHour * 60 + endMin;
        if (endMinutes < startMinutes) {
          endMinutes += 24 * 60;
        }
        const totalMinutes = endMinutes - startMinutes;
        return totalMinutes / 60;
      };

      const addShift = () => {
        if (currentShift.startTime && currentShift.endTime && currentShift.positionId) {
          const hours = calculateHours(currentShift.startTime, currentShift.endTime);
          const shift = {
            id: Date.now().toString(),
            ...currentShift,
            hours
          };
          saveShifts([...shifts, shift]);
          setCurrentShift({
            date: new Date().toISOString().split('T')[0],
            startTime: '',
            endTime: '',
            positionId: '',
            timecardPhoto: null,
            photoPreview: null
          });
          setView('dashboard');
        }
      };

      const deleteShift = (id) => {
        saveShifts(shifts.filter(s => s.id !== id));
      };

      const getTotalHours = () => {
        return shifts.reduce((sum, shift) => sum + shift.hours, 0).toFixed(1);
      };

      const getHoursByPosition = () => {
        const byPosition = {};
        shifts.forEach(shift => {
          const position = positions.find(p => p.id === shift.positionId);
          if (position) {
            byPosition[position.name] = (byPosition[position.name] || 0) + shift.hours;
          }
        });
        return byPosition;
      };

      const getWeeks = () => {
        const weeks = [];
        const sortedShifts = [...shifts].sort((a, b) => new Date(b.date) - new Date(a.date));
        
        sortedShifts.forEach(shift => {
          const shiftDate = new Date(shift.date);
          const weekStart = new Date(shiftDate);
          weekStart.setDate(shiftDate.getDate() - shiftDate.getDay());
          const weekKey = weekStart.toISOString().split('T')[0];
          
          if (!weeks.find(w => w.key === weekKey)) {
            weeks.push({
              key: weekKey,
              label: weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
              shifts: []
            });
          }
          
          const week = weeks.find(w => w.key === weekKey);
          week.shifts.push(shift);
        });
        
        return weeks;
      };

      const weeks = getWeeks();

      const showIOSInstallInstructions = () => {
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        return isIOS && !isInstalled;
      };

      // LOADING
      if (authView === 'loading') {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50">
            <div className="text-center">
              <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
              <p className="text-slate-600">Loading...</p>
            </div>
          </div>
        );
      }

      // AUTH SCREENS
      if (authView === 'login' || authView === 'signup') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4">
            <div className="max-w-md w-full">
              <div className="text-center mb-8">
                <div className="bg-gradient-to-br from-blue-600 to-blue-700 p-4 rounded-2xl shadow-lg inline-block mb-4">
                  <svg className="w-12 h-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <circle cx="12" cy="12" r="10" strokeWidth="2"></circle>
                    <path d="M12 7v5l3 2" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></path>
                  </svg>
                </div>
                <h1 className="text-4xl font-bold text-slate-900 mb-2">WorkProof</h1>
                <p className="text-slate-600">Track your work hours professionally</p>
              </div>

              <div className="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
                <div className="flex border-b border-slate-200">
                  <button
                    onClick={() => {
                      setAuthView('login');
                      setAuthError('');
                      setAuthForm({ email: '', password: '', confirmPassword: '', name: '' });
                    }}
                    className={`flex-1 py-4 font-semibold transition-colors ${
                      authView === 'login'
                        ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'
                        : 'text-slate-600 hover:bg-slate-50'
                    }`}
                  >
                    Login
                  </button>
                  <button
                    onClick={() => {
                      setAuthView('signup');
                      setAuthError('');
                      setAuthForm({ email: '', password: '', confirmPassword: '', name: '' });
                    }}
                    className={`flex-1 py-4 font-semibold transition-colors ${
                      authView === 'signup'
                        ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'
                        : 'text-slate-600 hover:bg-slate-50'
                    }`}
                  >
                    Sign Up
                  </button>
                </div>

                <div className="p-8">
                  {authError && (
                    <div className="mb-6 bg-red-50 border border-red-200 rounded-lg p-4">
                      <p className="text-red-700 text-sm">{authError}</p>
                    </div>
                  )}

                  <form onSubmit={authView === 'login' ? handleLogin : handleSignup} className="space-y-4">
                    {authView === 'signup' && (
                      <div>
                        <label className="block text-sm font-medium text-slate-700 mb-2">Full Name</label>
                        <input
                          type="text"
                          value={authForm.name}
                          onChange={(e) => setAuthForm({ ...authForm, name: e.target.value })}
                          className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="Enter your name"
                          required={authView === 'signup'}
                        />
                      </div>
                    )}

                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">Email</label>
                      <input
                        type="email"
                        value={authForm.email}
                        onChange={(e) => setAuthForm({ ...authForm, email: e.target.value })}
                        className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="your@email.com"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">Password</label>
                      <input
                        type="password"
                        value={authForm.password}
                        onChange={(e) => setAuthForm({ ...authForm, password: e.target.value })}
                        className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                        required
                      />
                    </div>

                    {authView === 'signup' && (
                      <div>
                        <label className="block text-sm font-medium text-slate-700 mb-2">Confirm Password</label>
                        <input
                          type="password"
                          value={authForm.confirmPassword}
                          onChange={(e) => setAuthForm({ ...authForm, confirmPassword: e.target.value })}
                          className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                          required={authView === 'signup'}
                        />
                      </div>
                    )}

                    <button
                      type="submit"
                      disabled={authLoading}
                      className="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                    >
                      {authLoading ? 'Processing...' : authView === 'login' ? 'Login' : 'Create Account'}
                    </button>
                  </form>
                </div>
              </div>

              <p className="text-center text-sm text-slate-600 mt-6">
                {authView === 'login' ? "Don't have an account? " : "Already have an account? "}
                <button
                  onClick={() => {
                    setAuthView(authView === 'login' ? 'signup' : 'login');
                    setAuthError('');
                    setAuthForm({ email: '', password: '', confirmPassword: '', name: '' });
                  }}
                  className="text-blue-600 hover:underline font-medium"
                >
                  {authView === 'login' ? 'Sign up' : 'Login'}
                </button>
              </p>
            </div>
          </div>
        );
      }

      // MAIN APP
      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
          {showInstallPrompt && (
            <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-3 shadow-lg">
              <div className="max-w-6xl mx-auto flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="bg-white/20 p-2 rounded-lg">
                    <svg className="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                  </div>
                  <div>
                    <p className="font-semibold">Install WorkProof</p>
                    <p className="text-sm text-blue-100">Add to your home screen for easy access</p>
                  </div>
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={handleInstall}
                    className="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium text-sm hover:bg-blue-50 transition-colors"
                  >
                    Install
                  </button>
                  <button
                    onClick={() => setShowInstallPrompt(false)}
                    className="text-white hover:text-blue-100 transition-colors"
                  >
                    âœ•
                  </button>
                </div>
              </div>
            </div>
          )}

          {showIOSInstallInstructions() && !showInstallPrompt && (
            <div className="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-4 py-3">
              <div className="max-w-6xl mx-auto">
                <div className="flex items-start gap-3">
                  <div className="text-lg mt-0.5">â‡§</div>
                  <div className="text-sm">
                    <p className="font-semibold mb-1">Install on iPhone</p>
                    <p className="text-purple-100">Tap the Share button below, then tap "Add to Home Screen"</p>
                  </div>
                </div>
              </div>
            </div>
          )}

          <div className="bg-white shadow-sm border-b border-slate-200">
            <div className="max-w-6xl mx-auto px-4 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="bg-gradient-to-br from-blue-600 to-blue-700 p-2 rounded-xl shadow-lg">
                    <svg className="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <circle cx="12" cy="12" r="10" strokeWidth="2"></circle>
                      <path d="M12 7v5l3 2" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></path>
                    </svg>
                  </div>
                  <div>
                    <h1 className="text-2xl font-bold text-slate-900">WorkProof</h1>
                    <p className="text-sm text-slate-500">Welcome, {currentUser?.user_metadata?.full_name || currentUser?.email || 'User'}</p>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <button
                    onClick={() => saveMode(mode === 'free' ? 'premium' : 'free')}
                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${
                      mode === 'premium'
                        ? 'bg-gradient-to-r from-amber-500 to-amber-600 text-white shadow-lg'
                        : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                    }`}
                  >
                    <span>â˜…</span>
                    {mode === 'premium' ? 'Premium' : 'Upgrade'}
                  </button>
                  <button
                    onClick={handleLogout}
                    className="flex items-center gap-2 px-4 py-2 rounded-lg font-medium bg-slate-100 text-slate-700 hover:bg-slate-200 transition-colors"
                  >
                    Logout
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div className="bg-white border-b border-slate-200">
            <div className="max-w-6xl mx-auto px-4">
              <div className="flex gap-1 overflow-x-auto">
                {[
                  { id: 'dashboard', label: 'Dashboard' },
                  { id: 'add-shift', label: 'Add Shift' },
                  { id: 'positions', label: 'Positions' },
                  { id: 'export', label: 'Export' }
                ].map(tab => (
                  <button
                    key={tab.id}
                    onClick={() => setView(tab.id)}
                    className={`flex items-center gap-2 px-6 py-3 font-medium transition-all whitespace-nowrap ${
                      view === tab.id
                        ? 'text-blue-600 border-b-2 border-blue-600'
                        : 'text-slate-600 hover:text-slate-900'
                    }`}
                  >
                    {tab.label}
                  </button>
                ))}
              </div>
            </div>
          </div>

          <div className="max-w-6xl mx-auto px-4 py-8 pb-24">
            {view === 'dashboard' && (
              <div className="space-y-6">
                <div className="grid md:grid-cols-3 gap-4">
                  <div className="bg-white rounded-xl p-6 shadow-sm border border-slate-200">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-slate-600 font-medium">Total Hours</p>
                        <p className="text-3xl font-bold text-slate-900 mt-1">{getTotalHours()}</p>
                      </div>
                      <div className="bg-blue-100 p-3 rounded-lg">
                        <svg className="w-6 h-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <circle cx="12" cy="12" r="10" strokeWidth="2"></circle>
                          <path d="M12 7v5l3 2" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></path>
                        </svg>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl p-6 shadow-sm border border-slate-200">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-slate-600 font-medium">Shifts Logged</p>
                        <p className="text-3xl font-bold text-slate-900 mt-1">{shifts.length}</p>
                      </div>
                      <div className="bg-green-100 p-3 rounded-lg">
                        <svg className="w-6 h-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <rect x="3" y="4" width="18" height="18" rx="2" strokeWidth="2"></rect>
                          <line x1="16" y1="2" x2="16" y2="6" strokeWidth="2"></line>
                          <line x1="8" y1="2" x2="8" y2="6" strokeWidth="2"></line>
                          <line x1="3" y1="10" x2="21" y2="10" strokeWidth="2"></line>
                        </svg>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl p-6 shadow-sm border border-slate-200">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-slate-600 font-medium">Positions</p>
                        <p className="text-3xl font-bold text-slate-900 mt-1">{positions.length}</p>
                      </div>
                      <div className="bg-purple-100 p-3 rounded-lg">
                        <svg className="w-6 h-6 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <rect x="2" y="7" width="20" height="14" rx="2" strokeWidth="2"></rect>
                          <path d="M16 7V5a2 2 0 0 0-2-2H10a2 2 0 0 0-2 2v2" strokeWidth="2"></path>
                        </svg>
                      </div>
                    </div>
                  </div>
                </div>

                {positions.length > 0 && (
                  <div className="bg-white rounded-xl p-6 shadow-sm border border-slate-200">
                    <h2 className="text-lg font-semibold text-slate-900 mb-4">Hours by Position</h2>
                    <div className="space-y-3">
                      {Object.entries(getHoursByPosition()).map(([position, hours]) => (
                        <div key={position} className="flex items-center justify-between">
                          <span className="text-slate-700 font-medium">{position}</span>
                          <span className="text-slate-900 font-semibold">{hours.toFixed(1)} hrs</span>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {weeks.length > 0 && (
                  <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 px-6 py-4 border-b border-slate-200">
                      <h2 className="text-lg font-semibold text-slate-900">Weekly Breakdown</h2>
                    </div>
                    <div className="divide-y divide-slate-200">
                      {weeks.map((week) => (
                        <div key={week.key} className="p-6">
                          <div className="flex items-center justify-between mb-4">
                            <h3 className="font-semibold text-slate-900">Week of {week.label}</h3>
                            <span className="text-sm font-medium text-slate-600">{week.shifts.reduce((sum, s) => sum + s.hours, 0).toFixed(1)} hours</span>
                          </div>
                          <div className="space-y-3">
                            {week.shifts.map(shift => {
                              const position = positions.find(p => p.id === shift.positionId);
                              return (
                                <div key={shift.id} className="flex items-center justify-between bg-slate-50 rounded-lg p-4">
                                  <div className="flex-1">
                                    <div className="flex items-center gap-3 flex-wrap">
                                      <div className="bg-blue-100 px-3 py-1 rounded-full">
                                        <span className="text-sm font-medium text-blue-700">{position?.name}</span>
                                      </div>
                                      <span className="text-slate-600 text-sm">
                                        {new Date(shift.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                                      </span>
                                    </div>
                                    <div className="flex items-center gap-4 mt-2 text-sm text-slate-600 flex-wrap">
                                      <span>{shift.startTime} - {shift.endTime}</span>
                                      <span className="font-semibold text-slate-900">{shift.hours.toFixed(1)} hrs</span>
                                      {shift.timecardPhoto && (
                                        <span className="flex items-center gap-1 text-green-600">
                                          ðŸ“· Verified
                                        </span>
                                      )}
                                    </div>
                                  </div>
                                  <button
                                    onClick={() => deleteShift(shift.id)}
                                    className="text-slate-400 hover:text-red-600 transition-colors ml-2"
                                  >
                                    âœ•
                                  </button>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {shifts.length === 0 && (
                  <div className="bg-white rounded-xl p-12 text-center shadow-sm border border-slate-200">
                    <div className="bg-slate-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                      <svg className="w-8 h-8 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <circle cx="12" cy="12" r="10" strokeWidth="2"></circle>
                        <path d="M12 7v5l3 2" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></path>
                      </svg>
                    </div>
                    <h3 className="text-xl font-semibold text-slate-900 mb-2">No shifts logged yet</h3>
                    <p className="text-slate-600 mb-6">Start tracking your work hours to build your professional record</p>
                    <button
                      onClick={() => setView('add-shift')}
                      className="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors"
                    >
                      Log Your First Shift
                    </button>
                  </div>
                )}
              </div>
            )}

            {view === 'add-shift' && (
              <div className="max-w-2xl mx-auto">
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                  <div className="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-8 text-white">
                    <h2 className="text-2xl font-bold mb-2">Log a Shift</h2>
                    <p className="text-blue-100">Add your work hours with timecard proof</p>
                  </div>

                  <div className="p-6 space-y-6">
                    {mode === 'premium' && (
                      <div className="bg-gradient-to-r from-amber-50 to-amber-100 border border-amber-200 rounded-lg p-4">
                        <div className="flex items-start gap-3">
                          <div className="text-amber-600 mt-0.5">â˜…</div>
                          <div>
                            <p className="font-semibold text-amber-900">AI Auto-Extract Available</p>
                            <p className="text-sm text-amber-700 mt-1">Upload a timecard photo and we'll automatically extract your hours</p>
                          </div>
                        </div>
                      </div>
                    )}

                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">Date</label>
                      <input
                        type="date"
                        value={currentShift.date}
                        onChange={(e) => setCurrentShift({...currentShift, date: e.target.value})}
                        className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                    </div>

                    <div className="grid md:grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-medium text-slate-700 mb-2">Start Time</label>
                        <input
                          type="time"
                          value={currentShift.startTime}
                          onChange={(e) => setCurrentShift({...currentShift, startTime: e.target.value})}
                          className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-slate-700 mb-2">End Time</label>
                        <input
                          type="time"
                          value={currentShift.endTime}
                          onChange={(e) => setCurrentShift({...currentShift, endTime: e.target.value})}
                          className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">Position</label>
                      <select
                        value={currentShift.positionId}
                        onChange={(e) => setCurrentShift({...currentShift, positionId: e.target.value})}
                        className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="">Select a position</option>
                        {positions.map(pos => (
                          <option key={pos.id} value={pos.id}>{pos.name}</option>
                        ))}
                      </select>
                      {positions.length === 0 && (
                        <p className="text-sm text-slate-600 mt-2">
                          No positions yet. <button onClick={() => setView('positions')} className="text-blue-600 hover:underline">Add one here</button>
                        </p>
                      )}
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Timecard Photo <span className="text-slate-500">(Optional but recommended)</span>
                      </label>
                      <div className="border-2 border-dashed border-slate-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors">
                        <input
                          type="file"
                          accept="image/*"
                          capture="environment"
                          onChange={handlePhotoUpload}
                          className="hidden"
                          id="photo-upload"
                        />
                        <label htmlFor="photo-upload" className="cursor-pointer">
                          {currentShift.photoPreview ? (
                            <div className="space-y-3">
                              <img src={currentShift.photoPreview} alt="Timecard" className="max-h-48 mx-auto rounded-lg" />
                              <p className="text-sm text-green-600 font-medium">Photo uploaded âœ“</p>
                            </div>
                          ) : (
                            <div className="space-y-3">
                              <div className="text-4xl text-slate-400">ðŸ“·</div>
                              <div>
                                <p className="font-medium text-slate-700">Upload timecard photo</p>
                                <p className="text-sm text-slate-500">Proof for your resume</p>
                              </div>
                            </div>
                          )}
                        </label>
                      </div>
                    </div>

                    <div className="flex gap-3 pt-4">
                      <button
                        onClick={addShift}
                        disabled={!currentShift.startTime || !currentShift.endTime || !currentShift.positionId}
                        className="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                      >
                        âœ“ Log Shift
                      </button>
                      <button
                        onClick={() => setView('dashboard')}
                        className="px-6 py-3 border border-slate-300 rounded-lg font-medium text-slate-700 hover:bg-slate-50 transition-colors"
                      >
                        Cancel
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {view === 'positions' && (
              <div className="max-w-2xl mx-auto">
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                  <div className="bg-gradient-to-r from-purple-600 to-purple-700 px-6 py-8 text-white">
                    <h2 className="text-2xl font-bold mb-2">Job Positions</h2>
                    <p className="text-purple-100">Manage the roles you work</p>
                  </div>

                  <div className="p-6 space-y-6">
                    <div className="flex gap-3">
                      <input
                        type="text"
                        value={newPosition}
                        onChange={(e) => setNewPosition(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && addPosition()}
                        placeholder="e.g., Cashier, Grill Cook, Drive-thru"
                        className="flex-1 px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                      />
                      <button
                        onClick={addPosition}
                        className="bg-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-purple-700 transition-colors flex items-center gap-2"
                      >
                        + Add
                      </button>
                    </div>

                    {positions.length > 0 ? (
                      <div className="space-y-2">
                        {positions.map(pos => (
                          <div key={pos.id} className="flex items-center justify-between bg-slate-50 rounded-lg p-4">
                            <div className="flex items-center gap-3">
                              <div className="bg-purple-100 p-2 rounded-lg">
                                <svg className="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <rect x="2" y="7" width="20" height="14" rx="2" strokeWidth="2"></rect>
                                  <path d="M16 7V5a2 2 0 0 0-2-2H10a2 2 0 0 0-2 2v2" strokeWidth="2"></path>
                                </svg>
                              </div>
                              <span className="font-medium text-slate-900">{pos.name}</span>
                            </div>
                            <button
                              onClick={() => deletePosition(pos.id)}
                              className="text-slate-400 hover:text-red-600 transition-colors"
                            >
                              âœ•
                            </button>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-8">
                        <div className="text-5xl text-slate-300 mb-3">ðŸ’¼</div>
                        <p className="text-slate-600">No positions added yet</p>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}

            {view === 'export' && (
              <div className="max-w-2xl mx-auto">
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                  <div className="bg-gradient-to-r from-green-600 to-green-700 px-6 py-8 text-white">
                    <h2 className="text-2xl font-bold mb-2">Export for Resume</h2>
                    <p className="text-green-100">Professional summary of your work hours</p>
                  </div>

                  <div className="p-6 space-y-6">
                    <div className="bg-slate-50 border border-slate-200 rounded-lg p-6">
                      <h3 className="font-semibold text-slate-900 mb-4">Work Summary</h3>
                      <div className="space-y-3 text-slate-700">
                        <p><span className="font-medium">Total Hours Worked:</span> {getTotalHours()} hours</p>
                        <p><span className="font-medium">Total Shifts:</span> {shifts.length}</p>
                        <p><span className="font-medium">Date Range:</span> {
                          shifts.length > 0 
                            ? `${new Date(Math.min(...shifts.map(s => new Date(s.date)))).toLocaleDateString()} - ${new Date(Math.max(...shifts.map(s => new Date(s.date)))).toLocaleDateString()}`
                            : 'No shifts logged'
                        }</p>
                        
                        {positions.length > 0 && (
                          <div>
                            <p className="font-medium mb-2">Hours by Position:</p>
                            <div className="pl-4 space-y-1">
                              {Object.entries(getHoursByPosition()).map(([position, hours]) => (
                                <p key={position}>â€¢ {position}: {hours.toFixed(1)} hours</p>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    </div>

                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                      <p className="text-sm text-blue-900">
                        <span className="font-semibold">Pro tip:</span> All your timecard photos are stored as proof. You can reference specific weeks and dates when employers ask for verification.
                      </p>
                    </div>

                    <button
                      onClick={() => {
                        const summary = `Work Hours Summary\n\nTotal Hours: ${getTotalHours()}\nTotal Shifts: ${shifts.length}\n\nPositions:\n${Object.entries(getHoursByPosition()).map(([p, h]) => `- ${p}: ${h.toFixed(1)} hours`).join('\n')}`;
                        navigator.clipboard.writeText(summary);
                        alert('Summary copied to clipboard!');
                      }}
                      className="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center gap-2"
                    >
                      â¬‡ Copy Summary to Clipboard
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WorkProofApp />);
  </script>
</body>
</html>

